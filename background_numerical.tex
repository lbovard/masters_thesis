\chapter{Numerical Stuff and Introductionary Theory}
\begin{itemize}
\item introduction to the boussinesq approximation 
\item In this section I should introduce the spectral method and the numerical scheme
\item Dealiasing tests 
\item  diffusion test
\item hyperviscosity
\end{itemize}
\section{Boussinesq approximation}

The equations can be written in the dimensional from as (add derivation, Kundu? Batchelor? Others?)

\begin{align}
\frac{\partial \bm{u}}{\partial t} + \bm{u}\cdot \nabla \bm{u} = -\frac{1}{\rho_{0}}\nabla p - \frac{\rho g}{\rho_{0}}\hat{\bm{e}}_{z} + \nu \nabla^{2}\bm{u} \label{boussinesq1}\\
\nabla \cdot \bm{u} =0 \label{boussinesq2}\\
\frac{\partial \rho}{\partial t} + \bm{u}\cdot \nabla \rho = \kappa \nabla^{2}\rho - \frac{\partial \bar{\rho}}{\partial z} w\label{boussinesq3}
\end{align}
where we have the following dimensional variables
\begin{itemize}
\item $\textbf{u}(x,y,z)=(u(x,y,z),v(x,y,z),w(x,y,z))$ is the velocity field in the $x,y,z$-directions directions respectively,
\item $p(x,y,z)$ is the pressure field,
\item $\rho(x,y,z)$ is a perturbation density,
\item $\rho_{0}$ is a constant reference density,
\item $\bar{\rho}$ is ... ? ,
\item $g$ is the gravitational constant,
\item $\nu$ is the constant kinematic velocity ,
\item $\kappa$ is the constant molecular diffusivity.
\end{itemize}
Equations (\ref{boussinesq1})-(\ref{boussinesq3}) are a set of five coupled partial differential equations for the unknowns $\textbf{u},p,\rho$. Herein, we will refer to equation (\ref{boussinesq1}) as the velocity equations, equation (\ref{boussinesq2}) as the continuity equation, and equation (\ref{boussinesq3}) as the density equation. 

Maybe go onto non-dimensionalisation? 

There is a difference between the linear and nonlinear equations (MIke's code uses a slightly modified version of Boussinesq that uses temperature) 
We take the above equations (Ref) as the starting point for our simulations. 

\section{Spectral Methods}
In this thesis we use the spectral method to evaluate the derivatives. Some more background. Spectral methods are based off the following observation. Let us denote the Fourier transform of $f(x)$ as $\hat{f}(k)$, given by
\begin{align}
\hat{f}(k) = \int_{-\infty}^{\infty}dxe^{-ikx}f(x)
\end{align}
Now consider the Fourier transform of the derivative $df/dx$. 
\begin{align}
\int_{-\infty}^{\infty}dxe^{-ikx}\frac{df}{dx}=e^{-ikx}f(x)\bigg|_{-\infty}^{\infty} + ik\int_{-\infty}^{\infty}dxe^{-ikx}f(x)= ik\hat{f}(k)
\end{align}
and thus the Fourier transform of a derivative is just $ik$ times the Fourier transform of $f(x)$. We have assumed here that $f(x)$ vanishes sufficiently quickly at infinity. For most applications of the Fourier transform, this assumption is valid. In this thesis, all functions considered will vanish quickly enough although see section below. (add bit about decay?). In general, it is easy to show that the Fourier transform of $d^{n}f/dx^{n}$ is $(ik)^{n}\hat{f}(k)$. 

Computationally, if we have a quick way to evalute $\hat{f}(k)$ from $f(x)$ and $f(x)$ from $\hat{f}(k)$, then the $n^{\text{th}}$ derivative is easy to compute and results from multiplying by the simple pre-factor $(ik)^{n}$. 

blah blah FFT. Discuss that here.


\section{Dealiasing} 
An important consideration in transforming between physical and Fourier space is the problem of aliasing.

Explain what it is! Blah blah wavenumbers meet and cross and cause problems.

Add derivation from Durran on this.

In the code we use a 2/3s rule however others have used other rules. To determine 

\section{1D Example} 
In this section we demonstrate the differences between solving PDEs in real space vs Fourier space. Consider the following one dimensional wave equation\cite{trefethen_spectral}
\begin{align}
\frac{\partial u}{\partial t} + c(x)\frac{\partial u}{\partial x} = 0,\qquad c(x)=\frac{1}{5}+\sin^{2}(x-1), \qquad u(x,0)=e^{-100(x-1)^{2}}, x\in[0,2\pi], t>0
\end{align}
where we are solving on a periodic domain. The physical interpretation of this equation is the simple one dimensional advection of a velocity field $u(x,t)$ by the fixed field $c(x)$. To illustrate issues relating to the spectral method, we will solve this problem in two ways: first we solve in the physical domain to demonstrate the idea of spectral differentiation and second to solve it in Fourier space to demonstrate the issues of dealiasing.

For a time-stepping scheme, we use a second-order Adams-Bashforth\cite{durran} scheme. Re-writing wave-equation as
\begin{align}
\frac{\partial u}{\partial t} = -c(x)\frac{\partial u}{\partial x} = F(u)
\end{align}
the Adams-Bashforth scheme is
\begin{align}
u^{n+1} = u^{n} + \frac{\dt}{2}[3F(u^{n})-F(u^{n-1})]
\end{align}
Since the Adams-Bashforth scheme uses a previous time-step, we will use forward Euler for the first time-step. To evalute $F(u)$ we will use the spectral differentiation, as discussed above. 
Figures go here.

Now we consider solving the equation in Fourier space. Taking the Fourier transform we obtain
\begin{align}
\frac{\partial \hat{u}}{\partial t} + \widehat{c(x)\frac{\partial u}{\partial x}}=0
\end{align}

\section{Navier-Stokes in Fourier Space}
We now turn to the formulation of the Navier-Stokes equations in a Fourier domain. The Fourier domain provides a convenient formulation to analyse the underlying mechanisms of turbulence, as we shall see. Recall that in the Fourier domain, derviatives become multiplcation of wavenumbers which converts the spatial parts of the Navier-Stokes equations into algebraic equations. 

To demonstrate the formulation in Fourier space, let us cast the standard Navier-Stokes equations into Fourier space. 
\begin{align}
\frac{\partial \textbf{u}}{\partial t} + \textbf{u}\cdot\nabla\textbf{u} = -\nabla p + \nabla^{2}\textbf{u}, \qquad \nabla\cdot\textbf{u}=0
\end{align}
where we have taken $\rho_{0},\nu=1$ for convenience as they do not change the overall result. Taking the Fourier transform of the above equation is straight-forward for all terms except the advection term $\textbf{u}\cdot\nabla\textbf{u}$, which we postpone for now.

In Fourier space, we can also exploit the following observation to eliminate the pressure term, thus saving the need to solve a Poisson equation at each time-step. The incompressibility condition becomes $\textbf{k}\cdot\hat{\textbf{u}}(\textbf{k},t)=0$ in Fourier space. Geometrically, this means that the vectors $\textbf{k}$ and $\hat{\textbf{u}}$ are orthogonal. To see this define a $\textbf{k}$-plane and a $\hat{\textbf{u}}$-plane. The defining equation of a plane is $ax+by+cz=d$ with the normal vector $\textbf{n}=(a,b,c)$. Here the normal vectors are $\textbf{k}$ and $\hat{\textbf{u}}$. Thus if the normal vectors are orthogonal, the planes are orthogonal.

This realisation tells us that vectors that are proportional to \uhatm are orthogonal to vectors that are proportional to \kvecm. Thus writing out the Navier-Stokes equations
\begin{align}
\frac{\partial \uhat}{\partial t} + \text{FT}(\textbf{u}\cdot\nabla\textbf{u}) = - \kvec\hat{p} - k^{2}\uhat
\end{align}
now take the dot product with \kvecm and using the orthogonality condition we obtain
\begin{align}
\kvec\cdot\text{FT}(\textbf{u}\cdot\nabla\textbf{u}) + k^{2}\hat{p}=0
\end{align}
This result is unsurprising, since all we have done is take the divergence of the Navier-Stokes equations, which in Fourier space corresponds to taking the dot product with respect to \kvecm. But using this observation we can avoid the need for solving the pressure altogether. Clearly the pressure term is orthogonal to the $\uhat$-plane. But what about the advection term? It can be thought of a vector that is pointing in some direction inbetween the planes of \kvec and \uhatm. By projecting the advection term into the $\uhat$-plane, we would have a set of equations that are independent of the pressure completely.

Consider the following projection operator
\begin{align}
P_{ij}(\kvec) = \delta_{ij} - \frac{k_{i}k_{j}}{k^{2}}
\end{align}
where we are using Einstein summation notation. Demonstrate that $\hat{u}_{j}P_{ij} = \hat{u}_{i}$ and so on. Thus if we apply $P_{ij}$ to NS we would get the Fourier transform version with no pressure. If we wanted to recover pressure we could use above.  Add discussion of the $\textbf{u}\cdot\nabla\textbf{u} = \omega\times \textbf{u} - \nabla \textbf{u}^{2}/2$ derivation. 

Another advantage of the Fourier formuation is the ability to exactly integrate the diffusion term. Let us denote the advective projective term as $F(\hat{u})$ and we have
\begin{align}
\frac{\partial \uhat}{\partial t} + \nu k^{2}\uhat = F(\uhat) 
\end{align}
where the left-hand side has been explicitly written out. Written in this form, the common trick of writing a product as a derivative is observed since
\begin{align}
 \frac{\partial \uhat}{\partial t} + \nu k^{2}\uhat= e^{-\nu k^{2}t}\frac{\partial \uhat e^{\nu k^{2}t}}{\partial t} 
\end{align}
